<!-- Student Table -->
<div class="content">
    <div class="container-fluid pt-4 px-4">
        <h3>Registered Students List</h3>

        <div class="bg-secondary text-center rounded p-4 mt-3">
            <div class="d-flex justify-content-between mb-3">
                <h6>Student User List</h6>
                <button class="btn btn-sm btn-primary"
                    (click)="loadStudentlist()">Refresh</button>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr class="text-white">
                            <th>#</th>
                            <th>Name</th>
                            <th>Gender</th>
                            <th>DOB</th>
                            <th>Email/Mobile No</th>
                            <th>Address</th>
                            <th>Institution Name</th>
                            <th>Department</th>
                            <th>Course</th>
                            <th>Academic Year</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of studentlist; let i = index">
                            <td>{{ i + 1 }}</td>
                            <td>{{ item.first_name }} {{ item.last_name }}</td>
                            <td>{{ item.gender }}</td>
                            <td>{{ item.dob | date: 'dd/MM/yyyy' }}</td>
                            <td>{{ item.contact }}</td>
                            <td>{{ item.address }}</td>
                            <td>{{ item.institution_name }}</td>
                            <td>{{ item.department }}</td>
                            <td>{{ item.course }}</td>
                            <td>{{ item.academic_year }}</td>
                            <td>
                                <span [ngClass]="getStatusClass(item.status)">
                                    {{ item.status == 1 ? 'Active' : 'Inactive'
                                    }}
                                </span>
                            </td>
                            <td class="d-flex gap-2">
                                <button class="btn btn-sm btn-warning"
                                    (click)="viewStudentRecord(item)"
                                    title="View">
                                    <i class="fa fa-eye"></i>
                                </button>
                                <button class="btn btn-sm"
                                    [ngClass]="item.status === 1 ? 'btn-danger' : 'btn-success'"
                                    (click)="toggleStatus(item)">
                                    {{ item.status === 1 ? 'Deactivate' :
                                    'Activate' }}
                                </button>
                                <button class="btn btn-sm btn-danger"
                                    (click)="openDeleteConfirm(item.id)">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- View Modal -->
    <div class="modal" [class.show]="showViewModal" *ngIf="showViewModal"
        style="display:block;">
        <div class="modal-dialog">
            <div class="modal-content bg-secondary p-3">
                <div class="modal-header">
                    <h5 class="modal-title">Student Details</h5>
                    <button type="button"
                        class="btn btn-square btn-outline-primary m-2"
                        (click)="closeViewModal()">X</button>
                </div>
                <div class="profile-card-container">
                    <!-- Profile Header -->
                    <div class="profile-header">
                        <div class="profile-image">
                            <img
                                *ngIf="selectedStudent?.profile_image_url; else noImage"
                                [src]="selectedStudent.profile_image_url"
                                alt="Profile Image"
                                class="avatar" />
                            <ng-template #noImage>
                                <img src="assets/default-avatar.png"
                                    alt="No Image" class="avatar" />
                            </ng-template>
                        </div>
                        <div class="profile-name">
                            <h2>{{ selectedStudent?.first_name }} {{
                                selectedStudent?.last_name }}</h2>
                            <span class="status-badge"
                                [ngClass]="{ 'active': selectedStudent?.status == 1, 'inactive': selectedStudent?.status != 1 }">
                                <i class="fas fa-info-circle"></i> {{
                                selectedStudent?.status == 1 ? 'Active' :
                                'Inactive' }}
                            </span>
                        </div>
                    </div>

                    <!-- Main Info Card -->
                    <div class="profile-details-card">
                        <ul class="profile-details-list">
                            <li>
                                <i class="fas fa-venus-mars"></i>
                                <span class="label">Gender:</span>
                                <span class="value">{{ selectedStudent?.gender
                                    }}</span>
                            </li>
                            <li>
                                <i class="fas fa-birthday-cake"></i>
                                <span class="label">DOB:</span>
                                <span class="value">{{ selectedStudent?.dob |
                                    date: 'dd/MM/yyyy' }}</span>
                            </li>
                            <li>
                                <i class="fas fa-phone"></i>
                                <span class="label">Contact:</span>
                                <span class="value">{{ selectedStudent?.contact
                                    }}</span>
                            </li>
                            <li>
                                <i class="fas fa-home"></i>
                                <span class="label">Address:</span>
                                <span class="value">{{ selectedStudent?.address
                                    }}</span>
                            </li>
                            <li>
                                <i class="fas fa-school"></i>
                                <span class="label">Institution:</span>
                                <span class="value">{{
                                    selectedStudent?.institution_name }}</span>
                            </li>
                            <li>
                                <i class="fas fa-building"></i>
                                <span class="label">Department:</span>
                                <span class="value">{{
                                    selectedStudent?.department }}</span>
                            </li>
                            <li>
                                <i class="fas fa-book"></i>
                                <span class="label">Course:</span>
                                <span class="value">{{ selectedStudent?.course
                                    }}</span>
                            </li>
                            <li>
                                <i class="fas fa-calendar"></i>
                                <span class="label">Academic Year:</span>
                                <span class="value">{{
                                    selectedStudent?.academic_year }}</span>
                            </li>
                        </ul>
                        <div class="last-updated"
                            *ngIf="selectedStudent?.updated_at">
                            <i class="fas fa-clock"></i>
                            <span> Last Updated: {{ selectedStudent?.updated_at
                                |
                                date:'dd/MM/yyyy HH:mm' }}</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Delete Confirmation -->
    <div *ngIf="confirmDeleteId !== null" class="confirm-overlay">
        <div class="confirm-box p-3">
            <p>Are you sure to delete this student?</p>
            <button class="btn btn-success btn-sm"
                (click)="confirmDelete()">Yes</button>
            <button class="btn btn-danger btn-sm"
                (click)="cancelDelete()">No</button>
        </div>
    </div>
</div>
